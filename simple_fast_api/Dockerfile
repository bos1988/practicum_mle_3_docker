FROM python:3.11-slim
# вы указываете, что ваш образ будет основан на образе python:3.11-slim, в котором уже установлен Python

# LABEL author="mle-student"
LABEL author=${AUTHOR}
# ${AUTHOR} - это переменная среды
# инструкция LABEL задаёт метаданные для контейнера
# можно указать своё имя

COPY . ./simple_fast_api
# инструкция COPY копирует содержимое текущей директории в директорию, 
# которую указали второй командой - в данном случае это my_super_dir
# если такой директории не было, docker её создаст 

WORKDIR simple_fast_api
# изменяем рабочую директорию Docker 
# эта команда похожа на инструкцию RUN ["cd", "./my_super_dir"]
# в документации Docker рекомендуется использовать именно WORKDIR

RUN pip3 install -r requirements.txt
# устанавливаем библиотеки из файла requirements.txt
# который ранее был скопирован инструкцией COPY . ./simple_fast_api
# вместе со всем содержимым текущей директории в simple_fast_api

VOLUME /speeches
# указываем, что директория speeches внутри контейнера будет являться томом
# на этапе сборки docker создаст необходимые файлы на самой виртуальной машине
# в директории /var/lib/docker/volumes/

# EXPOSE 1702
EXPOSE ${APP_PORT}
# эта инструкция указывает образу, 
# что порт 1702 должен быть открыт 'снаружи'

# CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "1702"]
# эта инструкция указывает ту команду, которая должна выполниться при старте контейнера

CMD uvicorn app.main:app --host  0.0.0.0 --port ${APP_PORT}
# изменили команду на простую строку
